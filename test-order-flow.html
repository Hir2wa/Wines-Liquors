<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Flow Test - Total Wine & More</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .test-button {
        background: #dc3545;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .test-button:hover {
        background: #c82333;
      }
      .test-result {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üß™ Order Flow Test - Frontend Verification</h1>
      <p>
        This page tests the complete order management system to ensure
        everything works before moving to server-side implementation.
      </p>

      <div class="test-section">
        <h3>1. Test Order ID Generation</h3>
        <button class="test-button" onclick="testOrderIdGeneration()">
          Generate Test Order ID
        </button>
        <div id="orderIdResult" class="test-result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h3>2. Test Order Creation</h3>
        <button class="test-button" onclick="testOrderCreation()">
          Create Test Order
        </button>
        <div
          id="orderCreationResult"
          class="test-result"
          style="display: none"
        ></div>
      </div>

      <div class="test-section">
        <h3>3. Test Order Storage</h3>
        <button class="test-button" onclick="testOrderStorage()">
          Check Stored Orders
        </button>
        <div
          id="orderStorageResult"
          class="test-result"
          style="display: none"
        ></div>
      </div>

      <div class="test-section">
        <h3>4. Test Order Tracking</h3>
        <button class="test-button" onclick="testOrderTracking()">
          Test Order Lookup
        </button>
        <div
          id="orderTrackingResult"
          class="test-result"
          style="display: none"
        ></div>
      </div>

      <div class="test-section">
        <h3>5. Test Admin Functions</h3>
        <button class="test-button" onclick="testAdminFunctions()">
          Test Admin Dashboard
        </button>
        <div id="adminResult" class="test-result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h3>6. Clear Test Data</h3>
        <button class="test-button" onclick="clearTestData()">
          Clear All Test Orders
        </button>
        <div id="clearResult" class="test-result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h3>7. Navigation Test</h3>
        <p>Test navigation to all order management pages:</p>
        <a
          href="Order.html"
          class="test-button"
          style="text-decoration: none; display: inline-block"
          >Test Order Page</a
        >
        <a
          href="OrderTracking.html"
          class="test-button"
          style="text-decoration: none; display: inline-block"
          >Test Tracking Page</a
        >
        <a
          href="OrderHistory.html"
          class="test-button"
          style="text-decoration: none; display: inline-block"
          >Test History Page</a
        >
        <a
          href="AdminDashboard.html"
          class="test-button"
          style="text-decoration: none; display: inline-block"
          >Test Admin Dashboard</a
        >
        <a
          href="Profile.html"
          class="test-button"
          style="text-decoration: none; display: inline-block"
          >Test Profile Page</a
        >
      </div>
    </div>

    <script>
      // Test Order ID Generation
      function testOrderIdGeneration() {
        const result = document.getElementById("orderIdResult");
        try {
          // Simulate the generateOrderId function
          const timestamp = Date.now().toString().slice(-6);
          const random = Math.floor(Math.random() * 1000)
            .toString()
            .padStart(3, "0");
          const orderId = `ORD-${timestamp}${random}`;

          result.innerHTML = `<strong>‚úÖ Success:</strong> Generated Order ID: <code>${orderId}</code>`;
          result.className = "test-result success";
          result.style.display = "block";
        } catch (error) {
          result.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
          result.className = "test-result error";
          result.style.display = "block";
        }
      }

      // Test Order Creation
      function testOrderCreation() {
        const result = document.getElementById("orderCreationResult");
        try {
          const testOrder = {
            orderId: `ORD-${Date.now().toString().slice(-6)}${Math.floor(
              Math.random() * 1000
            )
              .toString()
              .padStart(3, "0")}`,
            customerInfo: {
              email: "test@example.com",
              phone: "+250123456789",
              firstName: "Test",
              lastName: "User",
              address: "123 Test Street",
              city: "Kigali",
              country: "Rwanda",
            },
            items: [
              {
                name: "Test Wine",
                price: "25,000frw",
                quantity: 1,
                image: "images/WINE1.webp",
              },
            ],
            paymentMethod: "card",
            total: "30,000frw",
            status: "pending",
            date: new Date().toISOString(),
            paymentStatus: "pending",
          };

          // Store test order
          const existingOrders = JSON.parse(
            localStorage.getItem("orders") || "[]"
          );
          existingOrders.push(testOrder);
          localStorage.setItem("orders", JSON.stringify(existingOrders));

          result.innerHTML = `<strong>‚úÖ Success:</strong> Created test order <code>${testOrder.orderId}</code> with ${testOrder.items.length} item(s)`;
          result.className = "test-result success";
          result.style.display = "block";
        } catch (error) {
          result.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
          result.className = "test-result error";
          result.style.display = "block";
        }
      }

      // Test Order Storage
      function testOrderStorage() {
        const result = document.getElementById("orderStorageResult");
        try {
          const orders = JSON.parse(localStorage.getItem("orders") || "[]");

          if (orders.length === 0) {
            result.innerHTML = `<strong>‚ÑπÔ∏è Info:</strong> No orders found in storage. Create a test order first.`;
            result.className = "test-result info";
          } else {
            result.innerHTML = `<strong>‚úÖ Success:</strong> Found ${orders.length} order(s) in storage:<br>`;
            orders.forEach((order) => {
              result.innerHTML += `‚Ä¢ ${order.orderId} - ${order.customerInfo.firstName} ${order.customerInfo.lastName} - ${order.status}<br>`;
            });
            result.className = "test-result success";
          }
          result.style.display = "block";
        } catch (error) {
          result.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
          result.className = "test-result error";
          result.style.display = "block";
        }
      }

      // Test Order Tracking
      function testOrderTracking() {
        const result = document.getElementById("orderTrackingResult");
        try {
          const orders = JSON.parse(localStorage.getItem("orders") || "[]");

          if (orders.length === 0) {
            result.innerHTML = `<strong>‚ÑπÔ∏è Info:</strong> No orders to track. Create a test order first.`;
            result.className = "test-result info";
          } else {
            const testOrder = orders[0];
            result.innerHTML = `<strong>‚úÖ Success:</strong> Found order <code>${testOrder.orderId}</code><br>`;
            result.innerHTML += `Status: ${testOrder.status}<br>`;
            result.innerHTML += `Customer: ${testOrder.customerInfo.firstName} ${testOrder.customerInfo.lastName}<br>`;
            result.innerHTML += `Items: ${testOrder.items.length}<br>`;
            result.innerHTML += `Total: ${testOrder.total}`;
            result.className = "test-result success";
          }
          result.style.display = "block";
        } catch (error) {
          result.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
          result.className = "test-result error";
          result.style.display = "block";
        }
      }

      // Test Admin Functions
      function testAdminFunctions() {
        const result = document.getElementById("adminResult");
        try {
          const orders = JSON.parse(localStorage.getItem("orders") || "[]");
          const pendingOrders = orders.filter(
            (order) => order.paymentStatus === "pending"
          );
          const totalRevenue = orders.reduce((sum, order) => {
            const amount = parseFloat(order.total.replace(/[^\d]/g, ""));
            return sum + amount;
          }, 0);
          const uniqueCustomers = new Set(
            orders.map((order) => order.customerInfo.email)
          ).size;

          result.innerHTML = `<strong>‚úÖ Success:</strong> Admin Dashboard Data:<br>`;
          result.innerHTML += `‚Ä¢ Total Orders: ${orders.length}<br>`;
          result.innerHTML += `‚Ä¢ Pending Payments: ${pendingOrders.length}<br>`;
          result.innerHTML += `‚Ä¢ Total Revenue: ${totalRevenue.toLocaleString()}frw<br>`;
          result.innerHTML += `‚Ä¢ Unique Customers: ${uniqueCustomers}`;
          result.className = "test-result success";
          result.style.display = "block";
        } catch (error) {
          result.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
          result.className = "test-result error";
          result.style.display = "block";
        }
      }

      // Clear Test Data
      function clearTestData() {
        const result = document.getElementById("clearResult");
        try {
          localStorage.removeItem("orders");
          result.innerHTML = `<strong>‚úÖ Success:</strong> All test orders cleared from storage.`;
          result.className = "test-result success";
          result.style.display = "block";
        } catch (error) {
          result.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
          result.className = "test-result error";
          result.style.display = "block";
        }
      }

      // Auto-run basic tests on page load
      document.addEventListener("DOMContentLoaded", function () {
        console.log("üß™ Order Flow Test Page Loaded");
        console.log("üìã Available Tests:");
        console.log("1. Order ID Generation");
        console.log("2. Order Creation");
        console.log("3. Order Storage");
        console.log("4. Order Tracking");
        console.log("5. Admin Functions");
        console.log("6. Clear Test Data");
        console.log("7. Navigation Tests");
      });
    </script>
  </body>
</html>

