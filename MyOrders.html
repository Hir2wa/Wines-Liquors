<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Management - NELVINTO Liquors store</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="Header.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .my-orders-container {
        min-height: 100vh;
        background: #f8f9fa;
      }

      .my-orders-header {
        background: white;
        border-bottom: 1px solid #e9ecef;
        padding: 20px 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .back-link {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: #f8f9fa;
        border: 1px solid #dc3545;
        border-radius: 6px;
        color: #dc3545;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .back-link:hover {
        background: #dc3545;
        color: white;
      }

      .logo img {
        height: 40px;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .cart-btn {
        position: relative;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: white;
        color: #495057;
        text-decoration: none;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .cart-btn:hover {
        background: #f8f9fa;
        color: #495057;
        border-color: #adb5bd;
      }

      .cart-count {
        background: #ffc107;
        color: #212529;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
      }

      .my-orders-section {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      .section-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .section-header h1 {
        font-size: 2.5rem;
        color: #212529;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .section-header p {
        font-size: 1.1rem;
        color: #6c757d;
        margin: 0;
      }

      .order-tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        background: white;
        border-radius: 12px;
        padding: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .tab-button {
        flex: 1;
        padding: 12px 24px;
        background: transparent;
        border: none;
        border-radius: 8px;
        font-weight: 500;
        color: #6c757d;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .tab-button.active {
        background: #dc3545;
        color: white;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
      }

      .tab-button:hover:not(.active) {
        background: #f8f9fa;
        color: #495057;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .order-search {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .search-form {
        display: flex;
        gap: 15px;
        max-width: 500px;
        margin: 0 auto;
      }

      .search-input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: #dc3545;
      }

      .search-btn {
        padding: 12px 24px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .search-btn:hover {
        background: #c82333;
      }

      .orders-list {
        display: grid;
        gap: 20px;
      }

      .order-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .order-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e9ecef;
      }

      .order-info h3 {
        font-size: 1.25rem;
        color: #212529;
        margin: 0 0 5px 0;
        font-weight: 600;
      }

      .order-date {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 0;
      }

      .order-status {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 5px;
      }

      .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .status-badge.pending {
        background: #fff3cd;
        color: #856404;
      }

      .status-badge.on_route {
        background: #d1ecf1;
        color: #0c5460;
      }

      .status-badge.shipped {
        background: #cce5ff;
        color: #004085;
      }

      .status-badge.delivered {
        background: #d4edda;
        color: #155724;
      }

      .status-badge.cancelled {
        background: #f8d7da;
        color: #721c24;
      }

      .payment-status {
        font-size: 0.75rem;
        color: #6c757d;
        font-weight: 500;
      }

      .order-items-preview {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .item-preview {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 8px;
        flex: 1;
        min-width: 200px;
      }

      .item-preview img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 4px;
      }

      .item-info h4 {
        font-size: 0.9rem;
        color: #212529;
        margin: 0 0 2px 0;
        font-weight: 500;
      }

      .item-info p {
        font-size: 0.8rem;
        color: #6c757d;
        margin: 0;
      }

      .more-items {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #e9ecef;
        padding: 10px;
        border-radius: 8px;
        color: #6c757d;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .order-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .order-total {
        font-size: 1.1rem;
        font-weight: 600;
        color: #dc3545;
      }

      .order-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
      }

      .btn-primary {
        background: #dc3545;
        color: white;
      }

      .btn-primary:hover {
        background: #c82333;
        color: white;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
        color: white;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #218838;
        color: white;
      }

      .btn-warning {
        background: #ffc107;
        color: #212529;
      }

      .btn-warning:hover {
        background: #e0a800;
        color: #212529;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background: #c82333;
        color: white;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
      }

      .empty-state i {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.3;
      }

      .empty-state h3 {
        font-size: 1.5rem;
        margin-bottom: 10px;
        color: #495057;
      }

      .empty-state p {
        font-size: 1rem;
        margin-bottom: 20px;
      }

      .loading-state {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
      }

      .loading-state i {
        font-size: 3rem;
        margin-bottom: 20px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error-state {
        text-align: center;
        padding: 60px 20px;
        color: #dc3545;
      }

      .error-state i {
        font-size: 4rem;
        margin-bottom: 20px;
      }

      .error-state h3 {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }

      .error-state p {
        font-size: 1rem;
        margin-bottom: 20px;
        color: #6c757d;
      }

      /* Order Creation Form Styles */
      .order-creation-form {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin: 0 auto;
      }

      .form-container h3 {
        color: #212529;
        margin-bottom: 30px;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #495057;
      }

      .form-group input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus {
        outline: none;
        border-color: #dc3545;
      }

      /* Readonly field styles */
      .form-group input[readonly],
      .readonly-field {
        background-color: #f8f9fa !important;
        cursor: not-allowed !important;
        color: #6c757d !important;
        border-color: #e9ecef !important;
        opacity: 0.8;
      }

      .form-group input[readonly]:focus,
      .readonly-field:focus {
        border-color: #e9ecef !important;
        box-shadow: none !important;
        outline: none !important;
      }

      /* Add a subtle icon to readonly fields */
      .readonly-field::after {
        content: "ðŸ”’";
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        opacity: 0.5;
      }

      .payment-methods {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      .payment-option {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 10px 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .payment-option:hover {
        border-color: #dc3545;
        background: #f8f9fa;
      }

      .payment-option input[type="radio"] {
        margin: 0;
        width: auto;
      }

      .payment-option input[type="radio"]:checked + span {
        color: #dc3545;
        font-weight: 600;
      }

      .order-summary {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin: 30px 0;
      }

      .order-summary h4 {
        color: #212529;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      /* Location Input Styles */
      .location-input-container {
        display: flex;
        gap: 10px;
        align-items: stretch;
      }

      .location-input-container input {
        flex: 1;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .location-input-container input:focus {
        outline: none;
        border-color: #dc3545;
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
      }

      .location-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 12px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .location-btn:hover {
        background: #218838;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
      }

      .location-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .location-status {
        margin-top: 8px;
        font-size: 13px;
        min-height: 20px;
      }

      .location-status.success {
        color: #28a745;
      }

      .location-status.error {
        color: #dc3545;
      }

      .location-status.loading {
        color: #007bff;
      }

      /* Order History Styles */
      .order-history-section {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .order-filters {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .filter-btn {
        padding: 10px 20px;
        border: 2px solid #dc3545;
        background: white;
        color: #dc3545;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .filter-btn.active,
      .filter-btn:hover {
        background: #dc3545;
        color: white;
      }

      .orders-grid {
        display: grid;
        gap: 20px;
      }

      .order-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #dc3545;
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .order-id {
        font-weight: bold;
        color: #dc3545;
        font-size: 1.1rem;
      }

      .order-date {
        color: #6c757d;
        font-size: 0.9rem;
      }

      .order-status {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: uppercase;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      .status-confirmed {
        background: #d1ecf1;
        color: #0c5460;
      }

      .status-on_route {
        background: #d1ecf1;
        color: #0c5460;
      }

      .status-shipped {
        background: #cce5ff;
        color: #004085;
      }

      .status-delivered {
        background: #d4edda;
        color: #155724;
      }

      .status-cancelled {
        background: #f8d7da;
        color: #721c24;
      }

      .order-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 15px;
      }

      .order-info {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .order-info-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
      }

      .order-info-item i {
        width: 16px;
        color: #6c757d;
      }

      .order-items {
        margin-top: 15px;
      }

      .order-items h4 {
        margin-bottom: 10px;
        color: #495057;
      }

      .item-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: #f8f9fa;
        border-radius: 6px;
      }

      .item-name {
        font-weight: 500;
      }

      .item-details {
        color: #6c757d;
        font-size: 0.9rem;
      }

      .order-total {
        text-align: right;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e9ecef;
      }

      .total-amount {
        font-size: 1.2rem;
        font-weight: bold;
        color: #dc3545;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #6c757d;
      }

      .loading i {
        font-size: 2rem;
        animation: spin 1s linear infinite;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .location-input-container {
          flex-direction: column;
        }

        .location-btn {
          justify-content: center;
        }
      }

      .order-total {
        text-align: right;
        font-size: 1.2rem;
        color: #dc3545;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #dee2e6;
      }

      .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #dee2e6;
      }

      .cart-item:last-child {
        border-bottom: none;
      }

      .item-info {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
      }

      .item-details h5 {
        margin: 0;
        font-size: 0.9rem;
        color: #212529;
      }

      .item-details p {
        margin: 0;
        font-size: 0.8rem;
        color: #6c757d;
      }

      .quantity-controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .qty-btn {
        width: 28px;
        height: 28px;
        border: 1px solid #dc3545;
        background: white;
        color: #dc3545;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        transition: all 0.3s ease;
      }

      .qty-btn:hover {
        background: #dc3545;
        color: white;
      }

      .qty-display {
        min-width: 25px;
        text-align: center;
        font-weight: 600;
        color: #333;
        font-size: 0.9rem;
      }

      .remove-btn {
        width: 28px;
        height: 28px;
        border: 1px solid #dc3545;
        background: #dc3545;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        transition: all 0.3s ease;
        margin-left: 5px;
      }

      .remove-btn:hover {
        background: #c82333;
        border-color: #c82333;
      }

      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          gap: 15px;
        }

        .order-tabs {
          flex-direction: column;
        }

        .search-form {
          flex-direction: column;
        }

        .order-header {
          flex-direction: column;
          gap: 15px;
        }

        .order-status {
          align-items: flex-start;
        }

        .order-footer {
          flex-direction: column;
          align-items: stretch;
        }

        .order-actions {
          justify-content: center;
        }

        .item-preview {
          min-width: auto;
        }

        /* Mobile Responsive for Order Management Section */
        .section-header {
          text-align: center;
          padding: 20px 15px;
          margin-bottom: 25px;
        }

        .section-header h1 {
          font-size: 1.8rem;
          margin-bottom: 8px;
          line-height: 1.2;
        }

        .section-header p {
          font-size: 0.9rem;
          line-height: 1.4;
          max-width: 100%;
        }

        .order-tabs {
          flex-direction: column;
          gap: 8px;
          padding: 15px;
          margin: 0 15px 25px 15px;
          max-width: none;
        }

        .tab-button {
          padding: 15px 20px;
          font-size: 16px;
          min-height: 50px;
        }

        /* Header Mobile Improvements */
        .header-content {
          flex-direction: column;
          gap: 15px;
          padding: 0 15px;
        }

        .back-link {
          align-self: flex-start;
          padding: 10px 15px;
          font-size: 14px;
        }

        .logo img {
          height: 35px;
        }

        .header-actions {
          width: 100%;
          justify-content: center;
        }

        .cart-btn {
          padding: 10px 15px;
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="my-orders-container">
      <!-- Header -->
      <header class="my-orders-header">
        <div class="header-content">
          <a href="index.html" class="back-link">
            <i class="fas fa-arrow-left"></i>
            Back to Home
          </a>
          <div class="logo">
            <img
              src="images/logo1.png"
              alt="NELVINTO Liquors store Logo"
              style="width: 150px"
            />
          </div>
          <div class="header-actions">
            <a
              href="OrderHistory.html"
              class="cart-btn"
              style="margin-right: 10px"
            >
              <i class="fas fa-history"></i>
              <span>Order History</span>
            </a>
            <a href="MyOrders.html" class="cart-btn">
              <i class="fas fa-shopping-cart"></i>
              <span class="cart-count">0</span>
            </a>
          </div>
        </div>
      </header>

      <!-- My Orders Section -->
      <section class="my-orders-section">
        <div class="section-header">
          <h1>Order Management</h1>
          <p>Create, track, and manage all your orders in one place</p>
        </div>

        <!-- Order Tabs -->
        <div class="order-tabs">
          <button class="tab-button active" onclick="switchTab('create')">
            <i class="fas fa-plus"></i>
            Create Order
          </button>
          <button class="tab-button" onclick="switchTab('history')">
            <i class="fas fa-history"></i>
            Order History
          </button>
        </div>

        <!-- Create Order Tab -->
        <div id="create-order-tab" class="tab-content active">
          <div class="order-creation-form">
            <div class="form-container">
              <h3>Create New Order</h3>

              <form id="orderForm">
                <div class="form-row">
                  <div class="form-group">
                    <label for="firstName">First Name *</label>
                    <input
                      type="text"
                      id="firstName"
                      name="firstName"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="lastName">Last Name *</label>
                    <input type="text" id="lastName" name="lastName" required />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" required />
                  </div>
                  <div class="form-group">
                    <label for="phone">Phone *</label>
                    <input type="tel" id="phone" name="phone" required />
                  </div>
                </div>

                <div class="form-group">
                  <label for="location">Location *</label>
                  <div class="location-input-container">
                    <input
                      type="text"
                      id="location"
                      name="location"
                      placeholder="Enter your full address or click to get current location with zone details"
                      required
                    />
                    <button
                      type="button"
                      id="getLocationBtn"
                      class="location-btn"
                    >
                      <i class="fas fa-map-marker-alt"></i>
                      Get My Location
                    </button>
                  </div>
                  <div id="locationStatus" class="location-status"></div>
                </div>

                <div class="form-group">
                  <label>Payment Method *</label>
                  <div class="payment-methods">
                    <label class="payment-option">
                      <input
                        type="radio"
                        name="paymentMethod"
                        value="mobile_money"
                        required
                      />
                      <span>Mobile Money</span>
                    </label>
                    <label class="payment-option">
                      <input
                        type="radio"
                        name="paymentMethod"
                        value="cash_on_delivery"
                        required
                      />
                      <span>Cash on Delivery</span>
                    </label>
                  </div>

                  <!-- Mobile Money Payment Info -->
                  <div
                    class="form-group"
                    id="mobileMoneyInfo"
                    style="
                      display: none;
                      margin-top: 15px;
                      background: #f8f9fa;
                      padding: 15px;
                      border-radius: 8px;
                      border: 1px solid #e9ecef;
                    "
                  >
                    <h4
                      style="
                        margin: 0 0 10px 0;
                        color: #495057;
                        font-size: 16px;
                      "
                    >
                      <i
                        class="fas fa-mobile-alt"
                        style="margin-right: 8px; color: #28a745"
                      ></i>
                      Mobile Money Payment
                    </h4>
                    <p style="margin: 0; color: #6c757d; font-size: 14px">
                      Send payment to:
                      <strong>Eric Ntabwoba - 0784850196</strong>
                    </p>
                    <p
                      style="margin: 5px 0 0 0; color: #6c757d; font-size: 13px"
                    >
                      Please include your order reference in the payment
                      description.
                    </p>
                  </div>
                </div>

                <div class="order-summary">
                  <h4>Order Summary</h4>
                  <div id="cartItemsDisplay"></div>
                  <div class="order-total">
                    <strong>Total: <span id="orderTotal">0frw</span></strong>
                  </div>
                </div>

                <button
                  type="submit"
                  class="btn btn-primary"
                  id="createOrderBtn"
                >
                  <i class="fas fa-lock"></i> Create Order
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Order History Tab -->
        <div id="order-history-tab" class="tab-content">
          <div class="order-history-section">
            <div class="order-filters">
              <button class="filter-btn active" data-filter="all">
                All Orders
              </button>
              <button class="filter-btn" data-filter="pending">Pending</button>
              <button class="filter-btn" data-filter="on_route">
                On Route
              </button>
              <button class="filter-btn" data-filter="shipped">Shipped</button>
              <button class="filter-btn" data-filter="delivered">
                Delivered
              </button>
              <button class="filter-btn" data-filter="cancelled">
                Cancelled
              </button>
            </div>

            <div id="ordersContainer">
              <div class="loading">
                <i class="fas fa-spinner"></i>
                <p>Loading your orders...</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <script src="js/api-client.js"></script>
    <script>
      // Check if user is logged in
      function checkLoginStatus() {
        const isLoggedIn = localStorage.getItem("user_logged_in") === "true";
        const userData = localStorage.getItem("userData");

        if (!isLoggedIn || !userData) {
          showLoginPrompt();
          return false;
        }
        return true;
      }

      // Show login prompt
      function showLoginPrompt() {
        const ordersList = document.getElementById("ordersList");
        ordersList.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-user-lock"></i>
            <h3>Please Sign In</h3>
            <p>You need to be signed in to view your orders.</p>
            <div style="margin-top: 20px;">
              <a href="login.html" class="btn btn-primary" style="margin-right: 10px; text-decoration: none;">
                <i class="fas fa-sign-in-alt"></i> Sign In
              </a>
              <a href="Register.html" class="btn btn-secondary" style="text-decoration: none;">
                <i class="fas fa-user-plus"></i> Create Account
              </a>
            </div>
          </div>
        `;
      }

      // Switch between tabs
      function switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll(".tab-button").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        // Update tab content
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });

        if (tabName === "create") {
          document.getElementById("create-order-tab").classList.add("active");
          loadCartItems();
        } else if (tabName === "history") {
          document.getElementById("order-history-tab").classList.add("active");
          loadUserOrders();
        }
      }

      // Order History Functions
      let allOrders = [];
      let currentFilter = "all";

      // Load user orders
      async function loadUserOrders() {
        try {
          // Try multiple ways to get user email
          let userEmail = localStorage.getItem("userEmail");

          // If no userEmail, try to get from userData
          if (!userEmail) {
            const userData = localStorage.getItem("userData");
            if (userData) {
              try {
                const user = JSON.parse(userData);
                userEmail = user.email;
              } catch (e) {
                console.log("Could not parse userData:", e);
              }
            }
          }

          // If still no email, try to get from session
          if (!userEmail) {
            const sessionToken = localStorage.getItem("sessionToken");
            if (sessionToken) {
              // For now, use a default email for testing
              userEmail = "test@example.com";
            }
          }

          console.log("Using email:", userEmail); // Debug log

          if (!userEmail) {
            showEmptyState("Please log in to view your orders");
            return;
          }

          const response = await fetch(
            `/api/orders/customer?email=${encodeURIComponent(userEmail)}`
          );
          const result = await response.json();

          console.log("API Response:", result); // Debug log

          if (result.status === 200) {
            allOrders = result.data.orders || result.data;
            console.log("Orders loaded:", allOrders); // Debug log
            displayOrders(allOrders);
          } else {
            showEmptyState("Failed to load orders: " + result.message);
          }
        } catch (error) {
          console.error("Error loading orders:", error);
          showEmptyState("Error loading orders. Please try again.");
        }
      }

      // Display orders
      function displayOrders(orders) {
        const container = document.getElementById("ordersContainer");

        console.log("Displaying orders:", orders); // Debug log

        if (!orders || orders.length === 0) {
          showEmptyState("No orders found");
          return;
        }

        const ordersHtml = orders
          .map((order) => createOrderCard(order))
          .join("");
        container.innerHTML = `<div class="orders-grid">${ordersHtml}</div>`;
      }

      // Create order card HTML
      function createOrderCard(order) {
        console.log("Creating order card for:", order); // Debug log

        const statusClass = `status-${order.status}`;
        const formattedDate = new Date(
          order.date || order.createdAt
        ).toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });

        const items = order.items
          ? Array.isArray(order.items)
            ? order.items
            : order.items.split("||").map((item) => {
                const [name, price, quantity, image] = item.split("|");
                return { name, price, quantity, image };
              })
          : [];

        const itemsHtml = items
          .map(
            (item) => `
                <div class="item">
                    <div class="item-name">${item.name}</div>
                    <div class="item-details">Qty: ${item.quantity} Ã— ${item.price}</div>
          </div>
        `
          )
          .join("");

        return `
                <div class="order-card">
          <div class="order-header">
                        <div class="order-id">#${
                          order.orderId || order.id
                        }</div>
                        <div class="order-date">${formattedDate}</div>
                        <div class="order-status ${statusClass}">${
          order.status
        }</div>
            </div>
                    
                    <div class="order-details">
                        <div class="order-info">
                            <div class="order-info-item">
                                <i class="fas fa-user"></i>
                                <span>${order.customerInfo.firstName} ${
          order.customerInfo.lastName
        }</span>
            </div>
                            <div class="order-info-item">
                                <i class="fas fa-envelope"></i>
                                <span>${order.customerInfo.email}</span>
          </div>
                            <div class="order-info-item">
                                <i class="fas fa-phone"></i>
                                <span>${order.customerInfo.phone}</span>
          </div>
            </div>
                        <div class="order-info">
                            <div class="order-info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${order.customerInfo.location}</span>
            </div>
                            <div class="order-info-item">
                                <i class="fas fa-credit-card"></i>
                                <span>${order.paymentMethod
                                  .replace("_", " ")
                                  .toUpperCase()}</span>
          </div>
          </div>
              </div>
                    
                    <div class="order-items">
                        <h4>Order Items</h4>
                        <div class="item-list">
                            ${itemsHtml}
              </div>
            </div>
            
              <div class="order-total">
                        <div class="total-amount">Total: ${Number(
                          order.totalAmount
                        ).toLocaleString()} RWF</div>
            </div>
          </div>
        `;
      }

      // Show empty state
      function showEmptyState(message) {
        const container = document.getElementById("ordersContainer");
        container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-shopping-bag"></i>
                    <h3>${message}</h3>
                    <p>Start shopping to see your orders here</p>
                    <a href="index.html" class="btn btn-primary">Start Shopping</a>
                </div>
            `;
      }

      // Filter orders
      function filterOrders(filter) {
        currentFilter = filter;

        // Update active filter button
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        document
          .querySelector(`[data-filter="${filter}"]`)
          .classList.add("active");

        // Filter orders
        let filteredOrders = allOrders;
        if (filter !== "all") {
          filteredOrders = allOrders.filter((order) => order.status === filter);
        }

        displayOrders(filteredOrders);
      }

      // Load cart items for order creation
      function loadCartItems() {
        const cartData = localStorage.getItem("cartItems");
        const cartItemsDisplay = document.getElementById("cartItemsDisplay");
        const orderTotal = document.getElementById("orderTotal");

        if (!cartData) {
          cartItemsDisplay.innerHTML = `
             <div style="text-align: center; padding: 40px; color: #6c757d;">
               <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
               <h4>Your cart is empty</h4>
               <p>Add some items to your cart before creating an order.</p>
               <a href="index.html" class="btn btn-primary" style="margin-top: 15px; text-decoration: none;">
                 <i class="fas fa-shopping-bag"></i> Start Shopping
               </a>
             </div>
           `;
          orderTotal.textContent = "0frw";
          return;
        }

        try {
          const cartItems = JSON.parse(cartData);
          let total = 0;

          cartItemsDisplay.innerHTML = "";
          cartItems.forEach((item) => {
            const price = parseFloat(item.price.replace(/[^\d.]/g, ""));
            const itemTotal = price * (item.quantity || 1);
            total += itemTotal;

            cartItemsDisplay.innerHTML += `
               <div class="cart-item">
                 <div class="item-info">
                   <div class="item-details">
                     <h5>${item.name}</h5>
                     <p>Price: ${item.price}</p>
                   </div>
                 </div>
                 <div class="quantity-controls">
                   <button class="qty-btn" onclick="decrementQuantity(${
                     item.id
                   })">
                     <i class="fas fa-minus"></i>
                   </button>
                   <span class="qty-display">${item.quantity || 1}</span>
                   <button class="qty-btn" onclick="incrementQuantity(${
                     item.id
                   })">
                     <i class="fas fa-plus"></i>
                   </button>
                   <button class="remove-btn" onclick="removeItem(${item.id})">
                     <i class="fas fa-trash"></i>
                   </button>
                 </div>
               </div>
             `;
          });

          orderTotal.textContent = `${total.toLocaleString()}frw`;
        } catch (error) {
          console.error("Error loading cart items:", error);
          cartItemsDisplay.innerHTML = `
             <div style="text-align: center; padding: 20px; color: #dc3545;">
               <i class="fas fa-exclamation-triangle"></i>
               <p>Error loading cart items</p>
             </div>
           `;
        }
      }

      // Clean price format
      function cleanPrice(price) {
        if (!price) return "0";
        return price.toString().replace(/[^\d.]/g, "");
      }

      // Auto-fill user information using session management
      async function autoFillUserInfo() {
        const sessionToken = localStorage.getItem("sessionToken");

        if (!sessionToken) {
          return; // User not logged in
        }

        await fetchUserDataWithToken(sessionToken);
      }

      // Helper function to fetch user data with a token
      async function fetchUserDataWithToken(token) {
        try {
          // Fetch current user data from session
          const response = await fetch("/api/auth/me", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (response.ok) {
            const userData = await response.json();

            if (userData.success && userData.data) {
              const user = userData.data;

              // Auto-fill form fields with user data
              const emailField = document.getElementById("email");
              const firstNameField = document.getElementById("firstName");
              const lastNameField = document.getElementById("lastName");
              const phoneField = document.getElementById("phone");

              // Fill and make readonly
              if (emailField && user.email) {
                emailField.value = user.email;
                makeFieldReadonly(emailField);
              }

              if (firstNameField && user.first_name) {
                firstNameField.value = user.first_name;
                makeFieldReadonly(firstNameField);
              }

              if (lastNameField && user.last_name) {
                lastNameField.value = user.last_name;
                makeFieldReadonly(lastNameField);
              }

              if (phoneField && user.phone) {
                phoneField.value = user.phone;
                makeFieldReadonly(phoneField);
              }

              // User data successfully filled
            } else {
              // Fallback to localStorage if API response is not successful
              fallbackToLocalStorage();
            }
          } else {
            // Fallback to localStorage if API request fails
            fallbackToLocalStorage();
          }
        } catch (error) {
          // Fallback to localStorage
          fallbackToLocalStorage();
        }
      }

      // Make a field readonly with proper styling
      function makeFieldReadonly(field) {
        field.readOnly = true;
        field.style.backgroundColor = "#f8f9fa";
        field.style.cursor = "not-allowed";
        field.style.color = "#6c757d";
        field.classList.add("readonly-field");
      }

      // Fallback to localStorage data
      function fallbackToLocalStorage() {
        const userData = localStorage.getItem("userData");

        if (userData) {
          try {
            const user = JSON.parse(userData);

            // Auto-fill form fields with user data from localStorage
            const emailField = document.getElementById("email");
            const firstNameField = document.getElementById("firstName");
            const lastNameField = document.getElementById("lastName");
            const phoneField = document.getElementById("phone");

            if (emailField && user.email) {
              emailField.value = user.email;
              makeFieldReadonly(emailField);
            }

            if (firstNameField && user.firstName) {
              firstNameField.value = user.firstName;
              makeFieldReadonly(firstNameField);
            }

            if (lastNameField && user.lastName) {
              lastNameField.value = user.lastName;
              makeFieldReadonly(lastNameField);
            }

            if (phoneField && user.phone) {
              phoneField.value = user.phone;
              makeFieldReadonly(phoneField);
            }

            // User data loaded from localStorage
          } catch (e) {
            // Silent fallback - no logging needed
          }
        }
      }

      // Handle order form submission
      document
        .getElementById("orderForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const btn = document.getElementById("createOrderBtn");
          const cartData = localStorage.getItem("cartItems");

          if (!cartData) {
            alert(
              "Your cart is empty. Please add items before creating an order."
            );
            return;
          }

          try {
            const cartItems = JSON.parse(cartData);

            // Format cart items
            const formattedItems = cartItems.map((item) => ({
              name: item.name || item.title || "Unknown Item",
              price: cleanPrice(item.price) || "0",
              quantity: item.quantity || 1,
              image: item.image || item.src || null,
            }));

            // Get form data
            const formData = new FormData(this);

            // Debug: Log coordinates being sent
            const latitude = formData.get("latitude");
            const longitude = formData.get("longitude");
            console.log("Coordinates being sent:", { latitude, longitude });
            console.log("Coordinate types:", {
              latitudeType: typeof latitude,
              longitudeType: typeof longitude,
              latitudeValue: latitude,
              longitudeValue: longitude,
            });

            // Debug: Check if hidden fields exist and have values
            const latitudeField = document.getElementById("latitude");
            const longitudeField = document.getElementById("longitude");
            console.log("Hidden fields check:", {
              latitudeFieldExists: !!latitudeField,
              longitudeFieldExists: !!longitudeField,
              latitudeFieldValue: latitudeField?.value,
              longitudeFieldValue: longitudeField?.value,
            });

            // Ensure coordinates are properly captured
            let finalLatitude = latitude;
            let finalLongitude = longitude;

            // If coordinates are not in FormData, try to get them from the hidden fields
            if (!finalLatitude && latitudeField && latitudeField.value) {
              finalLatitude = latitudeField.value;
            }
            if (!finalLongitude && longitudeField && longitudeField.value) {
              finalLongitude = longitudeField.value;
            }

            console.log("Final coordinates being sent:", {
              latitude: finalLatitude,
              longitude: finalLongitude,
            });

            const orderData = {
              customerInfo: {
                email: formData.get("email"),
                phone: formData.get("phone"),
                firstName: formData.get("firstName"),
                lastName: formData.get("lastName"),
                location: formData.get("location"),
              },
              items: formattedItems,
              paymentMethod: formData.get("paymentMethod"),
              total: cleanPrice(
                document.getElementById("orderTotal").textContent
              ),
              latitude: finalLatitude,
              longitude: finalLongitude,
            };

            // Show loading state
            btn.innerHTML =
              '<i class="fas fa-spinner fa-spin"></i> Creating Order...';
            btn.disabled = true;

            // Create order
            const createdOrder = await createOrder(orderData);

            // Clear cart
            localStorage.removeItem("cartItems");
            localStorage.removeItem("cartCount");

            // Show success message
            alert(
              `ðŸŽ‰ Order #${
                createdOrder.orderId
              } created successfully! Total: ${Number(
                createdOrder.totalAmount
              ).toLocaleString()} RWF`
            );

            // Reset form
            this.reset();
            loadCartItems();

            // Redirect to order history page
            setTimeout(() => {
              window.location.href = "OrderHistory.html";
            }, 2000);
          } catch (error) {
            console.error("Order creation failed:", error);
            alert(`Failed to create order: ${error.message}`);
          } finally {
            // Reset button
            btn.innerHTML = '<i class="fas fa-lock"></i> Create Order';
            btn.disabled = false;
          }
        });

      // Quantity control functions
      function incrementQuantity(itemId) {
        const cartData = localStorage.getItem("cartItems");
        if (!cartData) return;

        const cartItems = JSON.parse(cartData);
        const item = cartItems.find((item) => item.id === itemId);

        if (item) {
          item.quantity = (item.quantity || 1) + 1;
          localStorage.setItem("cartItems", JSON.stringify(cartItems));
          loadCartItems(); // Refresh display
        }
      }

      function decrementQuantity(itemId) {
        const cartData = localStorage.getItem("cartItems");
        if (!cartData) return;

        const cartItems = JSON.parse(cartData);
        const item = cartItems.find((item) => item.id === itemId);

        if (item && item.quantity > 1) {
          item.quantity = item.quantity - 1;
          localStorage.setItem("cartItems", JSON.stringify(cartItems));
          loadCartItems(); // Refresh display
        }
      }

      function removeItem(itemId) {
        const cartData = localStorage.getItem("cartItems");
        if (!cartData) return;

        const cartItems = JSON.parse(cartData);
        const filteredItems = cartItems.filter((item) => item.id !== itemId);

        localStorage.setItem("cartItems", JSON.stringify(filteredItems));

        // Update cart count
        const cartCount = filteredItems.reduce(
          (total, item) => total + (item.quantity || 1),
          0
        );
        localStorage.setItem("cartCount", cartCount.toString());

        loadCartItems(); // Refresh display

        // Show message if cart is empty
        if (filteredItems.length === 0) {
          setTimeout(() => {
            alert("Cart is now empty. Add items to continue shopping!");
          }, 100);
        }
      }

      // Get user's current location
      function getCurrentLocation() {
        console.log("getCurrentLocation function called!");

        const locationInput = document.getElementById("location");
        const locationBtn = document.getElementById("getLocationBtn");
        const locationStatus = document.getElementById("locationStatus");

        console.log("Elements found:", {
          locationInput: !!locationInput,
          locationBtn: !!locationBtn,
          locationStatus: !!locationStatus,
        });

        // Get or create hidden fields for coordinates
        let latitudeField = document.getElementById("latitude");
        let longitudeField = document.getElementById("longitude");

        if (!latitudeField) {
          latitudeField = document.createElement("input");
          latitudeField.type = "hidden";
          latitudeField.id = "latitude";
          latitudeField.name = "latitude";
          document.getElementById("orderForm").appendChild(latitudeField);
          console.log("Created latitude hidden field");
        }

        if (!longitudeField) {
          longitudeField = document.createElement("input");
          longitudeField.type = "hidden";
          longitudeField.id = "longitude";
          longitudeField.name = "longitude";
          document.getElementById("orderForm").appendChild(longitudeField);
          console.log("Created longitude hidden field");
        }

        if (!navigator.geolocation) {
          locationStatus.innerHTML =
            '<i class="fas fa-exclamation-triangle"></i> Geolocation is not supported by this browser.';
          locationStatus.className = "location-status error";
          return;
        }

        // Show loading state
        locationBtn.disabled = true;
        locationBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Getting Location...';
        locationStatus.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Getting your current location...';
        locationStatus.className = "location-status loading";

        navigator.geolocation.getCurrentPosition(
          async function (position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            // Store coordinates in hidden fields
            latitudeField.value = latitude;
            longitudeField.value = longitude;

            // Debug: Log coordinates being stored
            console.log("GPS coordinates captured and stored:", {
              latitude,
              longitude,
            });
            console.log("Hidden field values:", {
              latitudeField: latitudeField.value,
              longitudeField: longitudeField.value,
            });

            try {
              // Use reverse geocoding to get detailed address
              const response = await fetch(
                `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`
              );

              if (response.ok) {
                const data = await response.json();

                // Log full location data for debugging
                console.log("Full location data:", data);
                console.log(
                  "Google Maps coordinates:",
                  `${latitude},${longitude}`
                );
                console.log(
                  "Google Maps link:",
                  `https://www.google.com/maps?q=${latitude},${longitude}`
                );

                // Build comprehensive address with all available details
                const addressParts = [];

                // Add street/road if available
                if (data.street) addressParts.push(data.street);
                if (data.streetNumber) addressParts.push(data.streetNumber);

                // Add locality (neighborhood/zone/village)
                if (data.locality) addressParts.push(data.locality);

                // Add city/town
                if (data.city) addressParts.push(data.city);

                // Add district/area
                if (data.principalSubdivision)
                  addressParts.push(data.principalSubdivision);

                // Add country
                if (data.countryName) addressParts.push(data.countryName);

                // Join all parts with commas
                const fullAddress = addressParts.join(", ");

                // Create Google Maps link for easy following
                const googleMapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
                const googleMapsString = `${latitude},${longitude}`;

                // If we have a good address, use it; otherwise use coordinates
                if (fullAddress.trim() && fullAddress !== data.countryName) {
                  locationInput.value = fullAddress;

                  // Create detailed status message with zone/village info and Google Maps link
                  const zoneInfo = data.locality || data.city || "Area";
                  const villageInfo = data.street ? ` (${data.street})` : "";

                  locationStatus.innerHTML = `
                    <div style="margin-bottom: 8px;">
                      <i class="fas fa-check-circle"></i> Location found: <strong>${zoneInfo}${villageInfo}</strong>
                    </div>
                    <div style="font-size: 12px; color: #6c757d;">
                      <i class="fas fa-map-marker-alt"></i> Coordinates: ${googleMapsString}
                    </div>
                    <div style="margin-top: 5px;">
                      <a href="${googleMapsLink}" target="_blank" style="color: #007bff; text-decoration: none; font-size: 12px;">
                        <i class="fas fa-external-link-alt"></i> Open in Google Maps
                      </a>
                    </div>
                  `;
                  locationStatus.className = "location-status success";
                } else {
                  // Fallback to coordinates with zone info
                  locationInput.value = `${latitude.toFixed(
                    6
                  )}, ${longitude.toFixed(6)}`;

                  locationStatus.innerHTML = `
                    <div style="margin-bottom: 8px;">
                      <i class="fas fa-map-marker-alt"></i> Location found: <strong>${
                        data.locality || "Area"
                      } zone</strong>
                    </div>
                    <div style="font-size: 12px; color: #6c757d;">
                      <i class="fas fa-map-marker-alt"></i> Coordinates: ${googleMapsString}
                    </div>
                    <div style="margin-top: 5px;">
                      <a href="${googleMapsLink}" target="_blank" style="color: #007bff; text-decoration: none; font-size: 12px;">
                        <i class="fas fa-external-link-alt"></i> Open in Google Maps
                      </a>
                    </div>
                  `;
                  locationStatus.className = "location-status success";
                }
              } else {
                // Fallback to coordinates if reverse geocoding fails
                const googleMapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
                const googleMapsString = `${latitude},${longitude}`;

                locationInput.value = `${latitude.toFixed(
                  6
                )}, ${longitude.toFixed(6)}`;
                locationStatus.innerHTML = `
                  <div style="margin-bottom: 8px;">
                    <i class="fas fa-map-marker-alt"></i> Location found (coordinates)
                  </div>
                  <div style="font-size: 12px; color: #6c757d;">
                    <i class="fas fa-map-marker-alt"></i> Coordinates: ${googleMapsString}
                  </div>
                  <div style="margin-top: 5px;">
                    <a href="${googleMapsLink}" target="_blank" style="color: #007bff; text-decoration: none; font-size: 12px;">
                      <i class="fas fa-external-link-alt"></i> Open in Google Maps
                    </a>
                  </div>
                `;
                locationStatus.className = "location-status success";
              }
            } catch (error) {
              // Fallback to coordinates
              const googleMapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
              const googleMapsString = `${latitude},${longitude}`;

              locationInput.value = `${latitude.toFixed(
                6
              )}, ${longitude.toFixed(6)}`;
              locationStatus.innerHTML = `
                <div style="margin-bottom: 8px;">
                  <i class="fas fa-map-marker-alt"></i> Location found (coordinates)
                </div>
                <div style="font-size: 12px; color: #6c757d;">
                  <i class="fas fa-map-marker-alt"></i> Coordinates: ${googleMapsString}
                </div>
                <div style="margin-top: 5px;">
                  <a href="${googleMapsLink}" target="_blank" style="color: #007bff; text-decoration: none; font-size: 12px;">
                    <i class="fas fa-external-link-alt"></i> Open in Google Maps
                  </a>
                </div>
              `;
              locationStatus.className = "location-status success";
            }

            // Reset button
            locationBtn.disabled = false;
            locationBtn.innerHTML =
              '<i class="fas fa-map-marker-alt"></i> Get My Location';
          },
          function (error) {
            let errorMessage = "";
            switch (error.code) {
              case error.PERMISSION_DENIED:
                errorMessage =
                  "Location access denied. Please allow location access or enter address manually.";
                break;
              case error.POSITION_UNAVAILABLE:
                errorMessage =
                  "Location information unavailable. Please enter address manually.";
                break;
              case error.TIMEOUT:
                errorMessage =
                  "Location request timed out. Please try again or enter address manually.";
                break;
              default:
                errorMessage =
                  "An unknown error occurred. Please enter address manually.";
                break;
            }

            locationStatus.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${errorMessage}`;
            locationStatus.className = "location-status error";

            // Reset button
            locationBtn.disabled = false;
            locationBtn.innerHTML =
              '<i class="fas fa-map-marker-alt"></i> Get My Location';
          },
          {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000,
          }
        );
      }

      // Initialize page
      // Handle payment method selection
      function handlePaymentMethodChange() {
        const paymentMethods = document.querySelectorAll(
          'input[name="paymentMethod"]'
        );
        const mobileMoneyInfo = document.getElementById("mobileMoneyInfo");

        paymentMethods.forEach((method) => {
          method.addEventListener("change", function () {
            if (this.value === "mobile_money") {
              mobileMoneyInfo.style.display = "block";
            } else {
              mobileMoneyInfo.style.display = "none";
            }
          });
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        loadCartItems();
        handlePaymentMethodChange();
        autoFillUserInfo(); // Auto-fill user info if logged in

        // Add event listener for location button
        const getLocationBtn = document.getElementById("getLocationBtn");
        if (getLocationBtn) {
          getLocationBtn.addEventListener("click", function () {
            console.log("Get Location button clicked!");
            getCurrentLocation();
          });
        } else {
          console.error("Get Location button not found!");
        }

        // Add event listeners for order history filter buttons
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const filter = this.getAttribute("data-filter");
            filterOrders(filter);
          });
        });
      });
    </script>
  </body>
</html>
