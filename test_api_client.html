<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Client Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background: #f8f9fa;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .btn {
        background: #dc3545;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .btn:hover {
        background: #c82333;
      }
      .result {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
        font-family: monospace;
        white-space: pre-wrap;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸ§ª API Client Test</h1>
      <p>Testing the API client functionality step by step.</p>

      <button class="btn" onclick="testAPIClient()">Test API Client</button>
      <button class="btn" onclick="testCreateOrder()">Test Create Order</button>
      <button class="btn" onclick="testGlobalCreateOrder()">
        Test Global Create Order
      </button>

      <div id="result" class="result"></div>
    </div>

    <script src="js/api-client.js"></script>
    <script>
      function log(message) {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML += message + "\n";
      }

      function clearLog() {
        document.getElementById("result").innerHTML = "";
      }

      async function testAPIClient() {
        clearLog();
        log("Testing API Client...");

        try {
          log("apiClient type: " + typeof apiClient);
          log("apiClient.createOrder type: " + typeof apiClient.createOrder);

          if (typeof apiClient === "undefined") {
            log("ERROR: apiClient is not defined!");
            document.getElementById("result").className = "result error";
            return;
          }

          log("âœ… API Client is loaded correctly");
          document.getElementById("result").className = "result success";
        } catch (error) {
          log("ERROR: " + error.message);
          document.getElementById("result").className = "result error";
        }
      }

      async function testCreateOrder() {
        clearLog();
        log("Testing API Client createOrder...");

        const orderData = {
          customerInfo: {
            email: "test@example.com",
            phone: "+250780146863",
            firstName: "Test",
            lastName: "User",
            address: "123 Test Street",
            city: "Kigali",
            country: "Rwanda",
          },
          items: [
            {
              name: "Premium Red Wine",
              price: "25000",
              quantity: 2,
              image: "images/WINE1.webp",
            },
          ],
          paymentMethod: "mobile_money",
          total: "50000",
        };

        try {
          log("Sending order data...");
          const response = await apiClient.createOrder(orderData);
          log("âœ… Order created successfully!");
          log("Response: " + JSON.stringify(response, null, 2));
          document.getElementById("result").className = "result success";
        } catch (error) {
          log("ERROR: " + error.message);
          log(
            "Error details: " +
              JSON.stringify(
                {
                  name: error.name,
                  message: error.message,
                  stack: error.stack,
                },
                null,
                2
              )
          );
          document.getElementById("result").className = "result error";
        }
      }

      async function testGlobalCreateOrder() {
        clearLog();
        log("Testing Global createOrder function...");

        const orderData = {
          customerInfo: {
            email: "test@example.com",
            phone: "+250780146863",
            firstName: "Test",
            lastName: "User",
            address: "123 Test Street",
            city: "Kigali",
            country: "Rwanda",
          },
          items: [
            {
              name: "Premium Red Wine",
              price: "25000",
              quantity: 2,
              image: "images/WINE1.webp",
            },
          ],
          paymentMethod: "mobile_money",
          total: "50000",
        };

        try {
          log("createOrder function type: " + typeof createOrder);

          if (typeof createOrder === "undefined") {
            log("ERROR: createOrder function is not defined!");
            document.getElementById("result").className = "result error";
            return;
          }

          log("Sending order data...");
          const response = await createOrder(orderData);
          log("âœ… Order created successfully!");
          log("Response: " + JSON.stringify(response, null, 2));
          document.getElementById("result").className = "result success";
        } catch (error) {
          log("ERROR: " + error.message);
          log(
            "Error details: " +
              JSON.stringify(
                {
                  name: error.name,
                  message: error.message,
                  stack: error.stack,
                },
                null,
                2
              )
          );
          document.getElementById("result").className = "result error";
        }
      }

      // Auto-test on page load
      window.addEventListener("load", function () {
        testAPIClient();
      });
    </script>
  </body>
</html>
