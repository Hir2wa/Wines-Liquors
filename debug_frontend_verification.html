<!DOCTYPE html>
<html>
  <head>
    <title>Debug Verification</title>
  </head>
  <body>
    <h1>Debug Email Verification</h1>

    <div>
      <h3>Test Registration</h3>
      <button onclick="testRegistration()">Register Test User</button>
      <div id="registrationResult"></div>
    </div>

    <div>
      <h3>Test Verification</h3>
      <input type="text" id="userId" placeholder="User ID" />
      <input
        type="text"
        id="verificationCode"
        placeholder="Verification Code"
      />
      <button onclick="testVerification()">Verify Code</button>
      <div id="verificationResult"></div>
    </div>

    <script>
      let testUserId = null;
      let testVerificationCode = null;

      async function testRegistration() {
        const data = {
          email: "debug_test_" + Date.now() + "@example.com",
          password: "Test123456",
          firstName: "Debug",
          lastName: "Test",
          phone: "+250788" + Math.floor(Math.random() * 1000000),
          address: "Test Address",
          city: "Kigali",
          country: "Rwanda",
        };

        try {
          const response = await fetch(
            "http://localhost:8000/api/auth/register",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            }
          );

          const result = await response.json();

          document.getElementById("registrationResult").innerHTML =
            "<pre>" + JSON.stringify(result, null, 2) + "</pre>";

          if (result.status === 201) {
            testUserId = result.data.user_id;
            testVerificationCode = result.data.verification.email_code;

            document.getElementById("userId").value = testUserId;
            document.getElementById("verificationCode").value =
              testVerificationCode;
          }
        } catch (error) {
          document.getElementById("registrationResult").innerHTML =
            '<p style="color: red;">Error: ' + error.message + "</p>";
        }
      }

      async function testVerification() {
        const userId = document.getElementById("userId").value;
        const code = document.getElementById("verificationCode").value;

        if (!userId || !code) {
          alert("Please enter both User ID and Verification Code");
          return;
        }

        try {
          const response = await fetch(
            "http://localhost:8000/api/auth/verify",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                userId: userId,
                code: code,
                type: "email",
              }),
            }
          );

          const result = await response.json();

          document.getElementById("verificationResult").innerHTML =
            "<pre>" + JSON.stringify(result, null, 2) + "</pre>";
        } catch (error) {
          document.getElementById("verificationResult").innerHTML =
            '<p style="color: red;">Network Error: ' + error.message + "</p>";
        }
      }
    </script>
  </body>
</html>

